# AI Writing Tool ‒ PRD v0.2

## 1. 产品愿景

打造一款「一条指令即可持续生成与自我审校」的 AI 写作工具，兼顾轻量创作与学术论文场景，让个人创作者在**最少的手动操作**下完成高质量长文。

## 2. 目标用户 & 用户场景

| 用户类型     | 典型场景       | 痛点                |
| -------- | ---------- | ----------------- |
| 知识型博主    | 日更博客 / 专栏  | 构思耗时，排版繁琐，资料搜索分心  |
| 研究生 / 学者 | 撰写综述、论文草稿  | 引用格式复杂，修改轮次多，查重压力 |
| 产品经理     | 写 PRD、需求文档 | 结构化输出 & 快速迭代      |

## 3. 目标 & KPI

| 目标     | 指标                                           | 2026 Q1 目标 |
| ------ | -------------------------------------------- | ---------- |
| 降低完稿时长 | 单篇 2 000 字稿件平均完稿时间                           | ≤ 30 min   |
| 提升内容质量 | 循环自检通过率（Grammar + Citation + Readability≥70） | ≥ 95 %     |
| 用户留存   | 次日留存                                         | ≥ 40 %     |

## 4. 核心用户需求

1. **一次性生成可用初稿**，避免空白恐惧。
2. **自动循环审校**（语法、引用、逻辑、可读性≥70），直到达标。
3. **即点即改** —— 选中文本后直接改写/扩写/翻译。
4. **引用管理**：一键插入 GB/T 7714 或 APA 格式脚注，**同时校验真伪**。
5. **流程透明 & 可回滚**：完整版本树可对比、回退。

## 5. 产品定位 & 价值主张

* **定位**：个人向 AI 长文创作工作台（PWA 首发）。
* **差异化**：结合 Claude Code 持久任务能力，实现“无人值守”写作循环；轻量 UI，学术 / 创作双模式切换；**引用实时校验 + 可读性量化**。

## 6. 功能需求

### 6.1 核心功能

1. **循环生成引擎（五步）**

   * **Plan → Draft → Citation‑Check → Grammar‑Lint → Readability‑Check**
   * 每一步若未达标即**自动回退**到 Draft 重写；允许用户随时插入 Prompt 触发重跑。
   * **可读性阈值 ≥ 70（Flesch‑Kincaid 改进公式）**。
2. **引用校验缓存**

   * 使用 **Redis 256 MB LRU 缓存** 存 DOI / PMID 元数据，目标命中率 ≥ 95 %。
   * 调用 CrossRef / PubMed API；失败 > 2 次标红提示并跳过写入。
3. **内容编辑器（中区）**

   * 富文本 + Markdown；语义块折叠与拖拽。
   * "灰层预览"：生成内容先蒙层展示，确认后写入。
4. **右侧 Chat / Prompt Feed**

   * Slash Command & Prompt Suggest；实时上下文嵌入。
5. **流程条 2.0**

   * 线性主线 + 分支节点；节点类型彩色区分；点击回滚。
   * 长任务进度环；日志弹窗。
6. **快速悬浮工具条**

   * 改写、扩写、翻译、引用、总结等 8 成高频操作。

### 6.2 辅助功能

* 引用解析插件（DOI/URL → GB/T、APA）。
* 多语言翻译对齐。
* 可读性 & 情感节奏仪表盘（≥ 30 min 打开）。
* Markdown/PDF/Word 导出；对话记录 JSON 导出。

## 7. 非功能需求

| 维度  | 需求                                  |
| --- | ----------------------------------- |
| 性能  | 交互延迟 ≤ 150 ms；生成首字 ≤ 3 s            |
| 缓存  | Redis 256 MB LRU，用于引用元数据；命中率 ≥ 95 % |
| 离线  | PWA 离线缓存正文 & 历史节点                   |
| 安全  | 草稿期允许 Auto‑Run；发布期强制权限确认            |
| 可扩展 | 插件 Manifest + REST；Worker 池水平扩容     |

## 8. 用户旅程 & 交互流程

1. **Landing**：选择空白 / 模板 → 输入主题或点 Prompt 建议。
2. **Draft Seed**：AI 生成大纲 & 段落骨架；流程条出现 Plan & Draft 节点。
3. **循环写作**：自动自检循环；用户可随时插入 Prompt 或手动编辑。
4. **Review Mode**：顶部切换；气泡标记错误；一键修复。
5. **Export / Publish**：选择格式或同步到集成（Notion、ArXiv）。

## 9. 信息架构（概要）

* **Collections**：Document, VersionNode, Prompt, Citation, PluginRun
* **状态机**：`idle → planning → drafting → citation_check → grammar_check → readability_check → done`

## 10. 技术架构

| 层   | 方案                                                             |
| --- | -------------------------------------------------------------- |
| 前端  | Next.js (App Router) + Zustand 状态管理 + tRPC，Service Worker 离线缓存 |
| 后台  | FastAPI + Redis Queue；Worker 处理循环任务与引用校验                       |
| 缓存  | **Redis 256 MB LRU**：存 DOI/PMID 元数据、引用校验结果，目标命中率 ≥ 95 %        |
| 模型层 | Anthropic API (Claude Opus) + 本地 MiniLM／fastText 自检            |
| 存储  | SQLite (MVP) → Postgres；引用 & 历史存 JSONB；对象存储用于导出文件              |

## 11. MVP 定义

| 功能   | 范围                                                                             |
| ---- | ------------------------------------------------------------------------------ |
| 循环引擎 | **Plan, Draft, Citation‑Check, Grammar‑Lint, Readability‑Check（≥ 70）**；阈值配置 UI |
| 编辑器  | 富文本 + 灰层预览；悬浮工具条 4 项                                                           |
| 流程条  | 线性历史 + 单步回滚                                                                    |
| 引用插件 | DOI → GB/T 7714 脚注 & 缓存命中率监控                                                   |
| 导出   | Markdown / PDF                                                                 |

## 12. 里程碑 & 预估

| Milestone    | 目标                                 | 时间 (周) |
| ------------ | ---------------------------------- | ------ |
| M0 概念验证      | 循环引擎 CLI Demo（含 Readability Check） | 2      |
| M1 MVP Alpha | 编辑器 + 流程条 + 引用插件 + Redis 缓存        | 6      |
| M2 Beta      | PWA 离线 & 仪表盘                       | 4      |
| M3 公开版本      | 插件生态 v1                            | 6      |

## 13. 风险 & 缓解

| 风险       | 等级 | 缓解方案                                 |
| -------- | -- | ------------------------------------ |
| API 费用超支 | 高  | Token 预估 + 限流；Auto‑Run 默认关闭；高价模型分层调用 |
| 循环死锁     | 中  | 超时 & 迭代次数上限；Watchdog 终止，并回滚到最近可用节点   |
| 引用准确率    | 中  | 双模型交叉验证；人工校对提示；缓存命中率告警               |

## 14. 后续迭代方向

* 版本树对比 / Merge Diff
* 语音 Prompt & 移动端优化
* 插件市场 & 收益分成
* AI‑assisted 图表生成

---

> **备注**：本 PRD 升级到 v0.2，整合了引用校验缓存、Readability≥70 阈值与失败回退策略。后续请继续评论或指出需进一步补充的部分。
