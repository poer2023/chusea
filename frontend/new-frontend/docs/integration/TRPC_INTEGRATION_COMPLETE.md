# tRPC v11 é›†æˆå®ŒæˆæŠ¥å‘Š

## ğŸ‰ é›†æˆçŠ¶æ€ï¼šâœ… å®Œæˆ

tRPC v11ç±»å‹å®‰å…¨APIé€šä¿¡å±‚å·²æˆåŠŸé›†æˆåˆ°ChUseAé¡¹ç›®ä¸­ï¼Œæä¾›å®Œæ•´çš„ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨APIé€šä¿¡åŠŸèƒ½ã€‚

## ğŸ“¦ å·²å®ç°çš„åŠŸèƒ½

### âœ… æ ¸å¿ƒé…ç½®
- **tRPCæœåŠ¡å™¨é…ç½®** (`src/server/trpc.ts`)
  - æ”¯æŒsuperjsonåºåˆ—åŒ–å™¨
  - é”™è¯¯æ ¼å¼åŒ–å™¨é…ç½®
  - è®¤è¯ä¸­é—´ä»¶æ”¯æŒ

- **ä¸Šä¸‹æ–‡é…ç½®** (`src/server/context.ts`)
  - ç”¨æˆ·ä¼šè¯ç®¡ç†
  - è¯·æ±‚å¤´å¤„ç†
  - IPåœ°å€è·å–

### âœ… APIè·¯ç”±å™¨
1. **è®¤è¯è·¯ç”±å™¨** (`src/server/api/routers/auth.ts`)
   - ç”¨æˆ·ç™»å½•/æ³¨å†Œ/ç™»å‡º
   - å¯†ç é‡ç½®å’Œä¿®æ”¹
   - é‚®ç®±éªŒè¯
   - Tokenåˆ·æ–°

2. **æ–‡æ¡£ç®¡ç†è·¯ç”±å™¨** (`src/server/api/routers/documents.ts`)
   - æ–‡æ¡£CRUDæ“ä½œ
   - æ–‡ä»¶å¤¹ç®¡ç†
   - æ–‡æ¡£åˆ†äº«åŠŸèƒ½
   - ç»Ÿè®¡ä¿¡æ¯

3. **å·¥ä½œæµè·¯ç”±å™¨** (`src/server/api/routers/workflow.ts`)
   - å·¥ä½œæµCRUDæ“ä½œ
   - å·¥ä½œæµæ‰§è¡Œç®¡ç†
   - æ‰§è¡Œè®°å½•æŸ¥è¯¢
   - ç»Ÿè®¡åˆ†æ

4. **ç”¨æˆ·ç®¡ç†è·¯ç”±å™¨** (`src/server/api/routers/user.ts`)
   - ç”¨æˆ·èµ„æ–™ç®¡ç†
   - åå¥½è®¾ç½®
   - å¤´åƒä¸Šä¼ 
   - ç®¡ç†å‘˜åŠŸèƒ½

### âœ… Next.js 15é›†æˆ
- **App Routeré€‚é…å™¨** (`src/app/api/trpc/[trpc]/route.ts`)
  - æ”¯æŒGET/POSTè¯·æ±‚
  - é”™è¯¯å¤„ç†å’Œè°ƒè¯•
  - ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

### âœ… å®¢æˆ·ç«¯é…ç½®
- **React Hooks** (`src/lib/trpc/client.ts`)
  - TanStack Query v5é›†æˆ
  - è‡ªåŠ¨é‡è¯•å’Œç¼“å­˜
  - é”™è¯¯å¤„ç†

- **æœåŠ¡å™¨ç«¯å®¢æˆ·ç«¯** (`src/lib/trpc/server.ts`)
  - SSRæ”¯æŒ
  - é™æ€ç”Ÿæˆæ”¯æŒ
  - ç¼“å­˜ä¼˜åŒ–

- **Providerç»„ä»¶** (`src/lib/trpc/provider.tsx`)
  - React Query DevTools
  - é”™è¯¯è¾¹ç•Œ
  - è®¤è¯tokenå¤„ç†

### âœ… ç±»å‹å®‰å…¨
- **å®Œæ•´ç±»å‹å®šä¹‰** (`src/lib/trpc/types.ts`)
  - è¾“å…¥/è¾“å‡ºç±»å‹æ¨æ–­
  - é”™è¯¯ç±»å‹å¤„ç†
  - å·¥å…·å‡½æ•°

- **å…¼å®¹æ€§ç±»å‹** (`src/types/index.ts`)
  - å‘åå…¼å®¹
  - ç±»å‹åˆ«å
  - ç»Ÿä¸€å¯¼å‡º

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å®¢æˆ·ç«¯ç»„ä»¶
```tsx
import { trpc } from '@/lib/trpc';

// æŸ¥è¯¢æ•°æ®
const { data, isLoading } = trpc.documents.list.useQuery({
  page: 1,
  limit: 10,
});

// ä¿®æ”¹æ•°æ®
const create = trpc.documents.create.useMutation({
  onSuccess: (data) => console.log('åˆ›å»ºæˆåŠŸ', data),
});
```

### æœåŠ¡å™¨ç»„ä»¶
```tsx
import { serverClient } from '@/lib/trpc/server';

// æœåŠ¡å™¨ç«¯æ•°æ®è·å–
const documents = await serverClient.documents.list({
  page: 1,
  limit: 10,
});
```

## ğŸ“Š APIç«¯ç‚¹æ¦‚è§ˆ

### è®¤è¯ (`/auth`)
- `login` - ç”¨æˆ·ç™»å½•
- `register` - ç”¨æˆ·æ³¨å†Œ  
- `logout` - ç”¨æˆ·ç™»å‡º
- `me` - è·å–å½“å‰ç”¨æˆ·
- `changePassword` - ä¿®æ”¹å¯†ç 
- `resetPassword` - é‡ç½®å¯†ç 
- `refreshToken` - åˆ·æ–°ä»¤ç‰Œ
- `verifyEmail` - éªŒè¯é‚®ç®±

### æ–‡æ¡£ (`/documents`)
- `list` - æ–‡æ¡£åˆ—è¡¨ (åˆ†é¡µã€æœç´¢ã€è¿‡æ»¤)
- `get` - è·å–å•ä¸ªæ–‡æ¡£
- `create` - åˆ›å»ºæ–‡æ¡£
- `update` - æ›´æ–°æ–‡æ¡£
- `delete` - åˆ é™¤æ–‡æ¡£
- `folders` - æ–‡ä»¶å¤¹ç®¡ç†
- `share` - æ–‡æ¡£åˆ†äº«
- `stats` - ç»Ÿè®¡ä¿¡æ¯

### å·¥ä½œæµ (`/workflow`)
- `list` - å·¥ä½œæµåˆ—è¡¨
- `get` - è·å–å·¥ä½œæµè¯¦æƒ…
- `create` - åˆ›å»ºå·¥ä½œæµ
- `update` - æ›´æ–°å·¥ä½œæµ
- `delete` - åˆ é™¤å·¥ä½œæµ
- `execute` - æ‰§è¡Œå·¥ä½œæµ
- `executions` - æ‰§è¡Œè®°å½•
- `stats` - ç»Ÿè®¡ä¿¡æ¯
- `stopExecution` - åœæ­¢æ‰§è¡Œ

### ç”¨æˆ· (`/user`)
- `profile` - ç”¨æˆ·èµ„æ–™
- `updateProfile` - æ›´æ–°èµ„æ–™
- `updatePreferences` - æ›´æ–°åå¥½
- `uploadAvatar` - ä¸Šä¼ å¤´åƒ
- `stats` - ç”¨æˆ·ç»Ÿè®¡
- `search` - æœç´¢ç”¨æˆ· (ç®¡ç†å‘˜)
- `updateRole` - æ›´æ–°è§’è‰² (ç®¡ç†å‘˜)
- `deleteAccount` - åˆ é™¤è´¦æˆ·

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### è®¤è¯çº§åˆ«
- **å…¬å¼€è®¿é—®** (`publicProcedure`) - æ— éœ€è®¤è¯
- **ç™»å½•ç”¨æˆ·** (`protectedProcedure`) - éœ€è¦æœ‰æ•ˆtoken  
- **ç®¡ç†å‘˜** (`adminProcedure`) - éœ€è¦ç®¡ç†å‘˜æƒé™

### æ•°æ®éªŒè¯
- ä½¿ç”¨Zodè¿›è¡Œè¾“å…¥éªŒè¯
- ç±»å‹å®‰å…¨çš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„éªŒè¯é”™è¯¯ä¿¡æ¯

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
- React Queryè‡ªåŠ¨ç¼“å­˜
- 5åˆ†é’ŸstaleTime
- 10åˆ†é’Ÿåƒåœ¾å›æ”¶æ—¶é—´
- æ™ºèƒ½é‡æ–°è·å–

### æ‰¹å¤„ç†
- HTTPæ‰¹å¤„ç†è¯·æ±‚
- å‡å°‘ç½‘ç»œå¾€è¿”
- ä¼˜åŒ–æ€§èƒ½

### é”™è¯¯å¤„ç†
- è‡ªåŠ¨é‡è¯•æœºåˆ¶
- 4xxé”™è¯¯ä¸é‡è¯•
- ç½‘ç»œé”™è¯¯æ™ºèƒ½é‡è¯•

## ğŸ› ï¸ å¼€å‘å·¥å…·

### DevToolsé›†æˆ
- React Query DevTools
- tRPCé”™è¯¯æ—¥å¿—
- ç±»å‹æ£€æŸ¥æ”¯æŒ

### è°ƒè¯•åŠŸèƒ½
- å¼€å‘ç¯å¢ƒè¯¦ç»†æ—¥å¿—
- é”™è¯¯å †æ ˆè·Ÿè¸ª
- æ€§èƒ½ç›‘æ§

## ğŸ“‹ ä»£ç ç¤ºä¾‹

å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹å¯åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼š
- `src/components/examples/trpc-examples.tsx` - Reactç»„ä»¶ç¤ºä¾‹
- `TRPC_INTEGRATION_GUIDE.md` - è¯¦ç»†ä½¿ç”¨æŒ‡å—

## ğŸ”§ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–
- `@trpc/client@^11.4.3` - tRPCå®¢æˆ·ç«¯
- `@trpc/server@^11.4.3` - tRPCæœåŠ¡å™¨
- `@trpc/next@^11.4.3` - Next.jsé›†æˆ
- `@trpc/react-query@^11.4.3` - React Queryé›†æˆ
- `superjson@^2.2.2` - æ•°æ®åºåˆ—åŒ–
- `zod@^3.25.76` - è¾“å…¥éªŒè¯

### æ¡†æ¶å…¼å®¹æ€§
- âœ… Next.js 15 App Router
- âœ… React 19
- âœ… TypeScript 5+
- âœ… TanStack Query v5

## ğŸ”„ é›†æˆçŠ¶æ€

### âœ… å·²å®Œæˆ
- [x] tRPCæœåŠ¡å™¨é…ç½®
- [x] APIè·¯ç”±å™¨å®ç°
- [x] Next.jsé€‚é…å™¨
- [x] å®¢æˆ·ç«¯é…ç½®
- [x] ç±»å‹å®šä¹‰
- [x] Provideré›†æˆ
- [x] é”™è¯¯å¤„ç†
- [x] å¼€å‘å·¥å…·
- [x] ä½¿ç”¨ç¤ºä¾‹
- [x] æ–‡æ¡£å®Œæ•´

### ğŸ”® æœªæ¥æ”¹è¿›
- [ ] å®é™…æ•°æ®åº“é›†æˆ
- [ ] JWTè®¤è¯å®ç°
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] WebSocketæ”¯æŒ
- [ ] ç¼“å­˜ä¼˜åŒ–
- [ ] æ€§èƒ½ç›‘æ§
- [ ] å•å…ƒæµ‹è¯•
- [ ] APIæ–‡æ¡£ç”Ÿæˆ

## ğŸ“ æ”¯æŒ

å¦‚éœ€æŠ€æœ¯æ”¯æŒæˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- `TRPC_INTEGRATION_GUIDE.md` - è¯¦ç»†ä½¿ç”¨æŒ‡å—
- `src/components/examples/trpc-examples.tsx` - ä»£ç ç¤ºä¾‹
- tRPCå®˜æ–¹æ–‡æ¡£: https://trpc.io/

---

**é›†æˆå®Œæˆæ—¶é—´**: 2025-01-20  
**tRPCç‰ˆæœ¬**: v11.4.3  
**Next.jsç‰ˆæœ¬**: 15.3.5  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª